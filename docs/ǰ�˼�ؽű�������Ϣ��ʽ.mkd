
# 前端监控脚本发送消息格式

田亮
2011/5



## 文档加载后，解析 DOM 结构及 HTML 源码。

资源统计&HTML错误的数据格式，有且仅有 1 次发送：

{
    "url":"https://www.alipay.com/",
    "ua":"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; zh-CN; rv:1.9.2.17) Gecko/20110420 Firefox/3.6.17",

    // HTML 资源列表。
    "res":{
        "img": ["https://static.alipay.com/logo.gif", "https://static.alipay.com/a.gif", "https://static.alipay.com/b.gif"],
        "css": ["https://static.alipay.com/a.css", "https://static.alipay.com/b.css"],
        "js" : ["https://static.alipay.com/a.js", "https://static.alipay.com/b.js"],
        "fla": ["https://static.alipay.com/a.swf", "https://static.alipay.com/b.swf"]
    },
    "htmlSize":1024,

    // DOM & HTML 不合法。
    "htmlError":[
        {
            "ln"    : 1,
            "err"   : 1,
            "code"  : "<label>no [for=id]</label>"
        },
        {
            "ln"    : 2,
            "err"   : 2,
            "code"  : "<input type=\"text\" value=\"no [name=name]\" />"
        }
    ]
}

## 页面头部引入脚本异常监控的脚本，页面抛出异常时，实时报告异常信息。

JavaScript 异常消息数据格式，可能有 0 或多次消息发送：

{
    "url":"https://www.alipay.com/",
    "ua":"Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10.6; zh-CN; rv:1.9.2.17) Gecko/20110420 Firefox/3.6.17",

    // JavaScript 异常，每一个脚本报错都实时发送。
    "jsError":{
        "ln":1,
        "file":"https://static.alipay.com/a.js",
        "msg":"n is undefined.",
        "code":"abc()->def()->function(){\n    throw new Error(\"test.\");\n}"
    }
}


## 最终将统计信息及异常报告压缩之后发送到服务端

http://ecmng.sit.alipay.net:7788/tj.jpg?${HASH}
