<!DOCTYPE HTML>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>sai - 其他</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="nico 0.5.1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link type="image/x-icon" href="../static/css/favicon.ico" rel="icon">
    <link rel="stylesheet" href="../static/css/normalize.css" />
    <link rel="stylesheet" href="../static/css/site.css" />
    <link rel="stylesheet" href="../static/css/solarized.css" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-50522089-2', 'spm documentation');
  ga('send', 'pageview');
</script>
<script src="http://static.alipayobjects.com/seajs/seajs/2.2.0/sea.js"></script>

<script>
  (function() {
  seajs.config({
    base: "../"
  });

  seajs.config({
    alias: {"arale-events":"sea-modules/arale-events/1.2.0/events.js","detector":"sea-modules/detector/2.0.1/detector.js","expect.js":"sea-modules/expect.js/0.3.1/index.js","jquery":"sea-modules/jquery/1.7.2/jquery.js"}
  });
})();
</script>
    <!--[if lt IE 9]>
    <script src="../static/js/html5shiv.js"></script>
    <![endif]-->
  </head>
  <body class="spmjs">
    <div class="body-wrapper">
      <aside class="sidebar-wrapper">
      <h1>
          <a href="../">Sai</a>
      </h1>
        <p class="sidebar-version">Version: <a href="http://spmjs.io/package/sai" title="">3.0.0</a></p>
        <p class="sidebar-description" data-keyword="utility">通用前端监控脚本</p>
        <a class="sidebar-source" href="https://github.com/saijs/sai.js" target="_blank">View the Project</a>
        <ul class="sidebar-navigation" role="navigation">
          <li><a href="../">Doc</a></li>
          <li><a href="../examples/">Demo</a></li>
          <li><a class="test-link" href="../tests/runner.html" target="_blank">Test</a></li>
        </ul>
        
<ol class="sidenav">
  <li><a href="index.html">前端监控脚本</a></li>
  <li><a href="intro.html">简介</a></li>
  <li><a href="data-specification-v2.html">数据通信规格(v2)</a></li>
  <li><a href="JSniffer.html">JSniffer</a></li>
  <li><a href="install.html">安装部署</a></li>
  <li><a href="data-specification-v1.html">数据通信规格(v1)</a></li>
  <li><a href="others.html">其他</a></li>
  <li><a href="script-crossorigin.html">script[crossorigin]</a></li>
  <li><a href="sourcemap.html">SourceMap</a></li>
  <li><a href="stack-trace.html">Stack Trace</a></li>
  <li><a href="window-onerror.html">window.onerror</a></li>
</ol>

      </aside>
      <div class="content-wrapper">
        
<article class="hentry">
  <h1 class="entry-title">其他</h1>
  <div class="entry-content">
    <h2 id="jsniffer">JSniffer<a href="#jsniffer" class="anchor">¶</a></h2><p>嗅探 JavaScript 异常，捕获异常信息：</p>
<ul>
<li>行号</li>
<li>出错文件</li>
<li>错误消息</li>
<li>错误上下文（函数体，调用过程）</li>
</ul>
<h2 id="domlint">DOMLint<a href="#domlint" class="anchor">¶</a></h2><h3 id="处理浏览器解析好的dom结构，检测异常情况：">处理浏览器解析好的DOM结构，检测异常情况：<a href="#处理浏览器解析好的dom结构，检测异常情况：" class="anchor">¶</a></h3><ul>
<li>DOCTYPE: <code>&quot;BackCompat&quot; != document.compatMode</code></li>
<li>编码<ul>
<li><code>head&gt;*:first-child == meta[charset]</code></li>
<li><code>head&gt;*:first-child == meta[http-equiv][content=text/html; charset=xxx]</code></li>
<li><code>script[src]:has([charset])</code></li>
<li><code>link[rel=stylesheet]:has([charset])</code></li>
</ul>
</li>
<li>文档标题: <code>head&gt;title</code></li>
<li>HTTPS 页面中是否有引用 HTTP 资源<ul>
<li><code>object[codebase=uri]</code></li>
<li><code>object&gt;param[src=uri]</code></li>
<li><code>object&gt;param[name=movie][value=uri]</code></li>
<li><code>embed[src=uri]</code></li>
<li><code>script[src=uri]</code></li>
<li><code>link[href=uri]</code></li>
<li><code>iframe[src=uri]</code></li>
<li><code>frame[src=uri]</code></li>
</ul>
</li>
<li>重复 ID 检查</li>
<li>元素异常嵌套情况<ul>
<li><code>p&gt;*:not(block-level)</code></li>
<li><code>pre&gt;*:not(block-level)</code></li>
<li><code>inline&gt;*:not(block-level)</code></li>
</ul>
</li>
<li><code>label[for]</code></li>
<li><code>img[alt][width[height]]</code></li>
<li>?: <code>textarea[rows][cols]</code></li>
</ul>
<h3 id="统计页面资源引用情况：">统计页面资源引用情况：<a href="#统计页面资源引用情况：" class="anchor">¶</a></h3><ul>
<li>img, javascript, css, flash 这些资源的使用情况</li>
<li>文档大小</li>
</ul>
<h2 id="htmlint">HTMLint<a href="#htmlint" class="anchor">¶</a></h2><h3 id="html-源码验证">HTML 源码验证<a href="#html-源码验证" class="anchor">¶</a></h3><p>在DOMReady后再请求一次当前地址，获得当前页面的HTML源码。然后解析源码：</p>
<ul>
<li><code>/^(\s*|&lt;!--.*?--&gt;)&lt;!DOCTYPE\s+[^&gt;]+&gt;/</code></li>
<li>Charset: [同 DOMLint]</li>
<li>Title: [同 DOMLint]</li>
<li>重复ID检测: [同 DOMLint]</li>
<li>标签非法嵌套情况<ul>
<li>!<code>inline&gt;block-level</code></li>
<li>!<code>p p</code></li>
<li>!<code>h[1-6]&gt;block-level</code></li>
<li>!<code>pre&gt;block-level</code><ul>
<li><a href="http://www.w3school.com.cn/tags/tag_pre.asp">HTML <pre> 标签</a></li>
</ul>
</li>
</ul>
</li>
<li>标签的闭合情况</li>
<li><code>label[for]</code></li>
<li><code>img[alt][width][height]</code></li>
<li>?: <code>textarea[rows][cols]</code></li>
</ul>
<h3 id="统计页面资源引用情况：">统计页面资源引用情况：<a href="#统计页面资源引用情况：" class="anchor">¶</a></h3><ul>
<li>img, javascript, css, flash 这些资源的使用情况</li>
<li>文档大小</li>
</ul>
<p>通过再发一次当前页面地址的GET请求，获取HTML源码的方式有以下风险：</p>
<ol>
<li>PV 倍增，服务器压力倍增</li>
<li>无法获取POST提交的页面的源码</li>
<li>服务端设置的token导致重复请求，而使获取的源码不一致</li>
<li>重复请求对业务可能的影响</li>
</ol>
<p>所以这种获取源码的方式只适用于使用GET请求访问、仅用于信息展示作用的页面。</p>
<p>另一种方法与DOM类似，取出的内容是被解析过的结果：
document.getElementsByTagName(&#39;html&#39;)[0].outerHTML
document.documentElement.outerHTML</p>
<p>终极方法是实现客户端插件，直接读取用户的浏览器缓存。</p>
<ul>
<li><a href="http://www.mnot.net/cache_docs/">http://www.mnot.net/cache_docs/</a> Caching Tutorial</li>
<li><a href="http://www.mnot.net/javascript/xmlhttprequest/cache.html">http://www.mnot.net/javascript/xmlhttprequest/cache.html</a> XMLHttpRequest Caching Tests</li>
<li><a href="http://www.web-caching.com/mnot_tutorial/how.html">http://www.web-caching.com/mnot_tutorial/how.html</a></li>
<li><p><a href="http://discuss.joelonsoftware.com/default.asp?joel.3.193583.5">http://discuss.joelonsoftware.com/default.asp?joel.3.193583.5</a> Get html source in javascript</p>
<p>[</p>
<pre>{
    tagStart:&quot;&lt;!DOCTYPE html&gt;&quot;,
    attrs:{},
    tagName: &quot;!DOCTYPE&quot;,
    tagEnd: null,
    children:null,
    parent: null
},
{
    tagStart:&quot;&lt;html xmlns=\&quot;http://...\&quot;&gt;&quot;,
    attrs:[
        xmlns:&quot;http://...&quot;
    ]
    tagName:&quot;html&quot;,
    tagEnd:&quot;&lt;/html&gt;&quot;,
    parent:null,
    children:[
        {
            tagStart:&quot;&lt;head&gt;&quot;,
            tagName:&quot;head&quot;,
            tagEnd:&quot;&lt;/head&gt;&quot;,
            parent:html,
            children:[
                {
                    tagStart:&quot;&lt;meta charset=\&quot;gbk\&quot; /&gt;&quot;,
                    tagEnd: null,
                    attrs:{
                        charset:&quot;gbk&quot;
                    }
                }
            ]
        }
    ],
    parent: null
}
</pre><p>]</p>
</li>
</ul>
<h2 id="cssniffer">CSSniffer<a href="#cssniffer" class="anchor">¶</a></h2><p>基于浏览器DOM嗅探整个文档使用背景图的情况，而无需重新请求加载源码。</p>
<h2 id="csslint">CSSLint<a href="#csslint" class="anchor">¶</a></h2><p>有两种检测机制：</p>
<ul>
<li>基于字符串简单解析源码，找出背景图的使用情况</li>
<li>CSS Parse 详细解析源码，找出：</li>
<li>背景图</li>
<li>硬编码</li>
<li>CSS hacks</li>
<li>基于 Alice 规范的检测。</li>
</ul>
<h2 id="jslint">JSLint<a href="#jslint" class="anchor">¶</a></h2><p>对于前端监控系统来说，目前实用价值不大，可作为兴趣研究项目。</p>
<ol>
<li>检查未定义的变量（会当作全局变量）</li>
</ol>
<h2 id="get-请求最大长度限制">GET 请求最大长度限制<a href="#get-请求最大长度限制" class="anchor">¶</a></h2><ul>
<li>Internet Explorer<ul>
<li>[<a href="http://support.microsoft.com/kb/208427/zh-cn">http://support.microsoft.com/kb/208427/zh-cn</a> 最大 URL 长度是在 Internet Explorer 中的 2,083 字符]</li>
<li>[<a href="http://support.microsoft.com/kb/254786/zh-cn">http://support.microsoft.com/kb/254786/zh-cn</a> 截断 PRB： 查询字符串]</li>
</ul>
</li>
<li>Firefox<ul>
<li>[<a href="http://forums.mozillazine.org/viewtopic.php?f=7&amp;t=322458">http://forums.mozillazine.org/viewtopic.php?f=7&amp;t=322458</a> What&#39;s the Maximum URL length in Firefox]</li>
</ul>
</li>
<li>Apache<ul>
<li>[<a href="http://httpd.apache.org/docs/2.2/mod/core.html#limitrequestline">http://httpd.apache.org/docs/2.2/mod/core.html#limitrequestline</a> LimitRequestLine Directive]</li>
<li>[<a href="http://stackoverflow.com/questions/1289585/what-is-apaches-maximum-url-length">http://stackoverflow.com/questions/1289585/what-is-apaches-maximum-url-length</a> What is apache&#39;s maximum url length?]</li>
</ul>
</li>
<li><p>URL</p>
<ul>
<li>[<a href="http://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url">http://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url</a> What is the maximum length of a URL?]</li>
<li>[<a href="http://www.boutell.com/newfaq/misc/urllength.html">http://www.boutell.com/newfaq/misc/urllength.html</a> What is the maximum length of a URL?]</li>
<li>[<a href="http://hiox.org/425-maximum-length-of-a-url.php">http://hiox.org/425-maximum-length-of-a-url.php</a> Maximum length of a URL]</li>
<li>[<a href="http://blog.csdn.net/somat/archive/2004/10/29/158707.aspx">http://blog.csdn.net/somat/archive/2004/10/29/158707.aspx</a> 两个长度限制问题的分析]</li>
<li>[<a href="http://www.leosio.com/max-length-with-get-method">http://www.leosio.com/max-length-with-get-method</a> GET方式传值的最大长度]</li>
<li>[<a href="http://blog.csdn.net/m_changgong/archive/2010/07/25/5764711.aspx">http://blog.csdn.net/m_changgong/archive/2010/07/25/5764711.aspx</a> HTTP Get请求URL最大长度]</li>
<li>[<a href="http://www.cnblogs.com/hyddd/archive/2009/03/31/1426026.html">http://www.cnblogs.com/hyddd/archive/2009/03/31/1426026.html</a> 浅谈HTTP中Get与Post的区别]</li>
<li>[<a href="http://hi.baidu.com/%BF%A8%C3%D7%D1%AA%CC%E3/blog/item/8042cb97570f08037bf480a3.html">http://hi.baidu.com/%BF%A8%C3%D7%D1%AA%CC%E3/blog/item/8042cb97570f08037bf480a3.html</a> Get方法提交URL的最大长度限制]</li>
</ul>
<p>IE:      2,083
FF:     65,536
Safari: 80,000
Opera: 190,000
Apache:  8,190
IIS:    16,384</p>
</li>
</ul>
<p>其他测试结果：
IE6.0                   :url最大长度2083个字符，超过最大长度后无法提交。
IE7.0                   :url最大长度2083个字符，超过最大长度后仍然能提交，但是只能传过去2083个字符。
firefox 3.0.3           :url最大长度7764个字符，超过最大长度后无法提交。
Opera 9.52              :url最大长度7648个字符，超过最大长度后无法提交。
Google Chrome 2.0.168   :url最大长度7713个字符，超过最大长度后无法提交。</p>
<p>Baidu:
IE6: 2152,2664,2152,2152,2089
IE8: 2344,2536,2152,
FF3: 3176,2472,2344,
Ch11: 2536,3238</p>
<p>ECMNG:
IE: 4095, 无效指针
FF,Chrome,Apache: 8209</p>
<h2 id="部署">部署<a href="#部署" class="anchor">¶</a></h2><p>JSniffer</p>
<p>DOMLint
HTMLint</p>
<p>==
开发环境 DEV
测试环境 SIT
    JSniffer</p>
<pre>DOMLint
HTMLint
CSSniffer
CSSLint
</pre><p>发布环境 PUB
    JSniffer</p>
<pre>DOMLint
CSSniffer

</pre><h2 id="see-also">See Also<a href="#see-also" class="anchor">¶</a></h2><ul>
<li><a href="https://damnit.jupiterit.com/home/learn"></a></li>
<li>HTML<ul>
<li><a href="http://www.planabc.net/2007/03/11/display_inline-block/">display:inline-block的深入理解</a></li>
<li><a href="http://www.cnblogs.com/svage/archive/2011/01/17/1937670.html">inline-block属性总结</a></li>
<li><a href="http://www.makben.cn/?p=305">XHTML标签的嵌套规则</a>,
<a href="http://www.cnblogs.com/newmin/archive/2011/02/18/1958059.html">2</a></li>
<li><a href="http://www.yzznl.cn/archives/52.html">p标签的应用</a></li>
<li><a href="http://www.xh-css.cn/2010/08/21/html-%E6%A0%87%E7%AD%BE%E5%B5%8C%E5%A5%97%E6%80%BB%E7%BB%93/">html 标签嵌套总结</a></li>
<li><a href="http://blog.bandao.cn/archive/39296/blogs-381381.aspx">什么是块级元素和内联元素?</a></li>
<li><a href="http://xiao3210li.blog.163.com/blog/static/96005640201052033459148/">谈谈两个可变元素——ins和del</a>
<a href="http://www.huihui.name/knowledge-sharing/530.html">2</a>
<a href="http://cache.baidu.com/c?m=9f65cb4a8c8507ed4fece763105392230e54f7397b8c8a5224c3933fcf3704165a3fbfe6627c475286926b6777ee130faaab6a272a0421b58cc8ff109be4cc3c6ad567627f0bf74205a36fb8ca3632b12a872eedb81897ad804684dfd9c4af5744bd55127bf0e7fd5c1767b97881642695ac8e49654863b9fa4316e82a743eec5057b737a2bc737906f1e1ad2f5bb25cc76061c1f86b&amp;p=9c769a46d29852f20aacc4710b1790&amp;user=baidu&amp;fm=sc&amp;query=%C1%BD%B8%F6%BF%C9%B1%E4%D4%AA%CB%D8%A1%AA%A1%AAins%BA%CDdel&amp;qid=a89dd50d0a7ae6ce&amp;p1=1">baidu cache</a></li>
<li><a href="http://ejohn.org/apps/htmlparser/">HTMLParser</a>
<a href="http://ejohn.org/blog/pure-javascript-html-parser/">blog</a></li>
<li><a href="http://kangax.github.com/html-minifier/">HTML Minifier</a></li>
</ul>
</li>
<li>CSS<ul>
<li><a href="http://cssparser.sourceforge.net/">CSS Parser</a></li>
<li><a href="http://www.codeproject.com/KB/recipes/CSSParser.aspx">Simple CSS Parser</a></li>
<li><a href="http://code.google.com/p/cssorder/">CSS Order - A Lint style maven2 plugin for CSS to validate best practice</a></li>
<li><a href="http://www.sitepoint.com/dustmeselectors/">Dust Me Selector</a>
<a href="https://addons.mozilla.org/en-US/firefox/addon/dust-me-selectors/">@addons.mozilla</a></li>
</ul>
</li>
</ul>

  </div>
</article>

      </div>
      
    </div>
    <div class="footer-wrapper">
      <footer>
        <p class="footer-powered"><a href="http://spmjs.io">spmjs.io</a> •
<a href="https://github.com/spmjs/spm">spm</a> •
<a href="http://seajs.org">Sea.js</a> •
<a href="http://lab.lepture.com/nico/">nico</a>
        </p>
      </footer>
    </div>
  </body>
</html>